create database clothes_shop;

create table app_role
(
    id   bigint auto_increment primary key,
    name varchar(255) not null
);

create table app_user
(
    id           bigint auto_increment primary key,
    email        varchar(255) not null,
    password     varchar(255) not null,
    name         varchar(255) not null,
    phone_number varchar(255) not null,
    role_id      bigint       not null default (1),
    constraint fk_app_role foreign key (role_id) references app_role (id),
    address      varchar(255) not null
);

create table clothes
(
    id     bigint auto_increment primary key,
    status boolean not null
);

create table clothes_detail
(
    id          bigint auto_increment primary key,
    clothes_id  bigint       not null,
    constraint fk_clothes foreign key (clothes_id) references clothes (id),
    name        varchar(255) not null,
    code        varchar(255) not null unique,
    price       double       not null,
    description text         null,
    quantity    int          not null,
    view_count  int          not null default (0),
    sold_amount int          not null default (0)
);

create table clothes_image
(
    id                bigint auto_increment primary key,
    source            varchar(255) not null,
    clothes_detail_id bigint       not null,
    constraint fk_clothes_detail foreign key (clothes_detail_id) references clothes_detail (id)
);

create table cart
(
    id          bigint auto_increment primary key,
    app_user_id bigint not null,
    constraint fk_app_user foreign key (app_user_id) references app_user (id)
);

create table cart_detail
(
    id          bigint auto_increment primary key,
    clothes_id  bigint not null,
    constraint fk_clothes_fr_cart_detail foreign key (clothes_id) references clothes (id),
    amount      int    not null,
    app_user_id bigint not null,
    constraint fk_app_user_fr_cart_detail foreign key (app_user_id) references app_user (id)
);

create table order_state
(
    id          bigint auto_increment primary key,
    name varchar(255) not null
);

create table payment
(
    id          bigint auto_increment primary key,
    name varchar(255) not null,
    description text not null
);

create table custom_order
(
    id          bigint auto_increment primary key,
    app_user_id bigint null,
    constraint fk_app_user_fr_order foreign key (app_user_id) references app_user (id),
    order_state_id bigint not null,
    constraint fk_order_state foreign key (order_state_id) references order_state(id),
    payment_id bigint not null ,
    constraint fk_payment foreign key (payment_id) references payment(id)
);

create table order_contact
(
    id          bigint auto_increment primary key,
    order_id bigint not null ,
    constraint fk_order foreign key (order_id) references custom_order(id),
    customer_name varchar(255) not null,
    address varchar(255) not null,
    phone_number varchar(255) not null
);

create table order_detail
(
    id          bigint auto_increment primary key,
    order_id bigint not null ,
    constraint fk_order_fr_order_detail foreign key (order_id) references custom_order(id),
    clothes_id  bigint not null,
    constraint fk_clothes_fr_order_detail foreign key (clothes_id) references clothes (id),
    amount int not null
);